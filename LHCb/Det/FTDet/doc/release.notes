!--------------------------------------------------------------------------
! Package     : Det/FTDet
! Purpose     : Interface to the xml description
! Responsible : Plamen Hopchev
!--------------------------------------------------------------------------

! 2013-05-15 - Paul Szczypka
 - Revert classIDs to original. Should be compatible with existing geo now.

!========================= FTDet v1r3 2013-02-04 =========================
! 2012-11-27 - Olivier Callot
 - add method findLayer( FTChannelID ) needed for track fit

!========================= FTDet v1r1 2012-11-26 =========================
! 2012-11-15 - Marco Clemencic
 - Added CMake configuration file.

!========================= FTDet v1r0 2012-09-28 =========================
! 2012-09-12 - Marco Clemencic
 - Minor change to simplify translation to CMake.

! 2012-07-25 P. Hopchev
   - Implement light sharing between neighbouring SiPM cells. For this
     purpose added two private methods: lightSharing and createLightSharingChannels.
     The former method implements the light sharing model (in this case it uses
     straight lines between [-0.5, 0] and [0, 0.5]), and the latter deals with
     the combination of the deposits in the neighbouring cells.
   - IMPORTANT: the method 'calculateHits' still fills a vector of FT pairs
     (FTChannelID + scalar), but the meaning of the scalar now is the MC particle
     energy fraction deposited in that channel (before was the fractional position
     of the energy deposit).
   - When checking if an MC hit is inside a layer, in the method 'calculateHits'
     we consider that the beam-pipe hole is a circle instead of a square. 

! 2012-06-19 P. Hopchev
  >>> Modifications addressing the suggestions received from the code review. For details see:
  >>> https://indico.cern.ch/getFile.py/access?contribId=3&sessionId=1&resId=0&materialId=slides&confId=190537

  - In all four det.element .h files change the classID values. Now
    they are 8601 (Detector), 8602 (Station), 8603 (BiLayer) and 8604 (Layer).
    Consequently "this" version of Det/FTDet should be used with Oliver's
    'static_DDDB_FT_v4' or later.
  - In DeFTLayer.h added one sentence to the comments clarifying the
    concept of 'net' cellID
  - In DeFTLayer: pass the argument of method cellUCoordinate by reference
    instead of by value
  - In DeFTLayer: modification of typedef namings to make the code more readable
  - In DeFTLayer.cpp make proper checks for NULL pointers when obtaining the
    layer geometrical limit. Also, added a warning comment that the way we obtain the
    layer geometrical limits is not robust against structural changes in the
    layer xml DDDB 
  - Move the (non-trivial) implementation of the method xAtVerticalBorder from the
    class definition in DeFTLayer.h to DeFTLayer.cpp
  - In DeFTDetector.cpp improve the readability of the methods
    'find{Stations,BiLayer,Layer}' by using a simple 'for' loop instead of
    std::find_if and boost::lambda
  - Change variable names in DeFTDetector and DeFTLayer: aPoint -> point,
    aChan -> channel
  - In DeFTLayer created a simple private method 'createChannel' which encapsulates
    the creation of FTChannelIDs and avoids the repetion of the same code in various
    places. Notably, the method 'calculateHits' becomes 30 lines shorter. 
 
!============ Upgrade detectors code review (2012-06-12) ==================

! 2012-06-06 P. Hopchev
  - Removed the prototype of the method createDetSegment(XYZPoint) from
    the Layer header file (ommission in the previous commit).

! 2012-06-06 P. Hopchev
  - In Layer, added a new member variable for the layer slope dzDy and
    the relevant accessor method.
  - Removed the method which creates a det. segment from a XYZ point
    and simplified the method which creates a det. segment from a
    ChannelID and the fractional position inside it
  - Now the created det. segments have the dyDz slope of the layer
 	
! 2012-06-06 P. Hopchev
  - Modified the Layer initialization to take into account that in the 
    latest version of the xml DDDB the beam-pipe is not a cylinder, but a cone
  - In DeFTDetector.cpp: simlified the code which prints the layer parameters
    during initialize. Now we take the properties by calling the relevant
    methods on the layers, instead of taking them from the xml DDDB.
    Added accessors for the layers min and max z-position.  	
    Also, the printout of the layer properties is now controlled
    by the MsgLevel (printing is done only in DEBUG or more verbose level)

! 2012-06-05 P. Hopchev
  - In DeFTDetector.h, DeFTStation.h, DeFTBiLayer and DeFTLayer.h:
    make more methods public

! 2012-06-01 P. Hopchev
  - In DeFTDetector.h make the method findLayer public to allow access
    to it in the FT digitization

! 2012-06-01 P. Hopchev
  - Change of the public/private policy: now almost all methods and variables
    are private. Exceptions are the constructors, destructors and classID accessors
    in all 4 det element classes (Detector, Station, BiLayer, Layer), and
    the methods 'calculateHits' and 'cellUCoordinate' in Layer.
  - Make the FTDet test alogrithm a friend of Detector and Layer so that it can
    call the private methods
  - In DeFTDetector.h and DeFTLayer.h moved the definitions of the trivial inline
    functions directly into the class definition
  - In Detector and Layer create a single MsgStream object at initialize,
    instead of every time a functions is called. Deallocate the memory by deleting
    the MsgStream object in newly created finalize methods. For now in Station and
    BiLayer we print something only in initialize, so the MsgStream modification
    is not made there.
  - In Layer added public functions to get xmin, xmax, ymin, ymax and z_at_center
    of the layer
  - Now the layerID and the stereoAngle are taken from the xml DDDB (==> requires
    a new version of the FT DDDB) and the relevant data members are set during the
    Layer initialization. Removed the Detector obsolete methods setLayerID and setAngle
  - use "format" instead of "boost::format" for printing the layer properties
 
!========================= First commit to svn (2012-05-31) ==========================

! 2012-05-30 P. Hopchev
  - Now create FTChannels also for non-sensitive cells: it is an invalid
    channel which can be recognized by its non-sense layerID: 15
  - Now consider that the beam-pipe hole is a circle (as it is in the FT xml DDDB)
    and not a square.
  - Modifications to the function which creates a DetectorSegment from an
    FTChannelID
  - Implement the functions nextChannelLeft and nextChannelRight

! 2012-05-29 P. Hopchev
  - Modifications to conform better to the LHCb coding conventions
  - rename directory 'job' to 'options' and add option file to run a test
    algorithm under the Boole environment

! 2012-05-25 P. Hopchev
  - Development of the calculateHits method in DeFTLayer
  - Currently 12 layers are intialized, with the inner ones inside each
    station having stereo angle of +/- 5 degrees

! 2012-05-09 P. Hopchev
First implementation of the package.
  - Adopt the cmt structure of Det/OTDet
  - Create DeFTDetector and DeFTLayer that read the xml geometry description
  - Create DeFTStation and DeFTBiLayer corresponding to the xml structure
    (not really needed or used for now)
  - Create the corresponding xml converters (in directory src/component)
  - Create a test algorithm and tool (in directory src/devel)

!========================= FTDet v0r1 2012-05-08 ==========================
